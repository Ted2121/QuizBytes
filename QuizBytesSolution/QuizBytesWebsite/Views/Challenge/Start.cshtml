@*
For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

<link rel="stylesheet" href="~/css/ChallengeQuizStyleSheet.css" />
<div class="wrapper">
<div class="quiz">
<div class="quiz-body">
    <div id="quiz-questions">
        <p id="error-message"></p>
    </div>
    </div>
</div>
</div>

<button class="btn-next" @*onclick="next()"*@>Next</button>
<script src ="~/lib/jquery/dist/jquery.js"></script>
@*<script src="~/js/ChallengeQuizLogic.js"></script>*@
<script>
    var questions= []; 
$.ajax({
        url: "@Url.Action("Quiz")",
        type: 'GET',
        dataType: "json",
        success: function (result) {
            console.log(result);
            for(let question of Object.values(result)){
                questions.push(question);
                console.log(questions);
            }

    let questionCount = 0;
    let correctAnswers = 0;
    var userAnswer;

    window.onload = function () {
        show(questionCount);

    }

    function show(count) {
        let question = document.getElementById("quiz-questions");
        let [first, second, third, fourth] = questions[0][count].answers.answerText;

        question.innerHTML = `<h2 class ="question-text">Q${count + 1}. ${questions[count].question}<h2>
            <ul class="question-options ">
            <li class="option">${first}</li>
            <li class="option">${second}</li>
            <li class="option">${third}</li>
            <li class="option">${fourth}</li>
            </ul>`
        toggleActive();
        //only works with questions that have 4 answers but I can write a separate method for ones with two answers
        // there is definitely a better way to code this but this works and I don't want to code js anymore today so yeah
        //figured out a better way to do this
    }

    function toggleActive() {
        let option = document.querySelectorAll("li.option");
        for (let i = 0; i < option.length; i++) {
            option[i].onclick = function () {
                for (let i = 0; i < option.length; i++) {
                    if (option[i].classList.contains("active")) {
                        option[i].classList.remove("active");
                        userAnswer = null;
                    }
                }
                option[i].classList.add("active");
            }
        }
    }

    function next() {
        if (questionCount == questions.length - 1) {
            location.href = "../Leaderboard/Display"
        }
        let userAnswer = $(".active").text();
        console.log(userAnswer);

        if (userAnswer == questions[questionCount].answer) {
            correctAnswers++;
            sessionStorage.setItem("Correct Answers:", correctAnswers)
            console.log(correctAnswers);
        }
        questionCount++;
        show(questionCount);
}
}
})
</script>